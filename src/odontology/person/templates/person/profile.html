{% extends 'base.html' %}
{% load staticfiles %}
{% block title %}Perfil - {{ patient.get_full_name }}{% endblock %}

{% block links %}
  <style media="screen">
    .table {
      margin-bottom: 0;
    }
  </style>
{% endblock %}

{% block extra_navs %}
  <li id="to_pdf" class="{% if last_benefit %}loader{% else %}disabled{% endif %}">
    <a  href="{% if last_benefit %}{% url 'register:benefit_to_pdf' patient_id=patient.id bf_id=last_benefit.id %}{% else %}#to_pdf{% endif %}">
      <i class="fa fa-file-pdf-o"></i> Exportar a pdf
    </a>
  </li>
{% endblock %}

{% block content %}
{{ block.super }}

{% if patient.social_work and patient.social_work.initial == 'APROSS' %}
  {% include "register/_add_apross.html" %}
{% else %}
  {% include "register/_add_benefit.html" %}
{% endif %}
<div class="modal fade" id="modal-edit-benefit" tabindex="-1" role="dialog" aria-labelledby="modal-Label">
    <div class="modal-dialog" role="document">
      <div class="modal-content">
        <div class="modal-header">
          <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
          <h4 class="modal-title" id="modal-Label">Editar registro de prestaci&oacute;n</h4>
        </div>
        <div class="loading text-center">
            <img src="{% static 'images/ring-alt.svg' %}" style="padding-top: 30px; padding-bottom: 30px;"></img>
        </div>
        <form id="benefit-edit-form" class="form-horizontal" role="form" method="POST" action="{% url 'register:edit_benefit' patient_id=patient.id %}">
            <div class="modal-body"></div>
            <div class="modal-footer"></div>
        </form>
      </div>
    </div>
</div>

<div class="row padding-top">
  <div class="col-md-6">
    <div class="panel panel-primary" id="basic-info">
      <div class="panel-heading"><strong>Paciente</strong> - Informaci&oacute;n b&aacute;sica</div>
      <div class="panel-body no-padding">
        <table class="table">
          <tbody>
            <tr>
              <th>Nombre</th>
              <td>{{ patient.get_full_name }}</td>
            </tr>
            <tr>
              <th>Obra social</th>
              <td>{{ patient.social_work|default_if_none:'Ninguna' }}</td>
            </tr>
            <tr>
              {% if patient.subsidiary_number %}
              <th>Nro de afiliado</th>
              <td><span class="label label-primary" style="font-size: 14px">{{ patient.subsidiary_number }}</span></td>
              {% else %}
              <th>&nbsp;</th>
              <td>&nbsp;</td>
              {% endif %}
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
  <div class="col-md-6">
    <div class="panel panel-primary">
      <div class="panel-heading"><strong>Odont&oacute;logo</strong> - Informaci&oacute;n b&aacute;sica</div>
      <div class="panel-body no-padding">
        <table class="table">
          <tbody>
            <tr>
              <th>Nombre</th>
              <td>{{ dentist.user.get_full_name }}</td>
            </tr>
            <tr>
              <th>C&iacute;rculo</th>
              <td>{{ dentist.circle }}</td>
            </tr>
            <tr>
              <th>N&deg; de Matr&iacute;cula</th>
              <td><span class="label label-primary" style="font-size: 14px">{{ dentist.register_number }}</span></td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>


  <div class="col-md-12" style="margin-bottom: 20px;">
      <div class="panel panel-primary">
        <div class="panel-body no-padding">
          <ul class="nav nav-tabs">
            <li role="presentation" id="tab-detail" class="active"><a href="#detail">Facturaci&oacute;n Mensual</a></li>
            <li role="presentation" id="tab-total-detail"><a href="#total-detail">Facturaci&oacute;n Acumulada</a></li>
            <li role="presentation" id="tab-odontogram"><a href="#odontogram">Odontograma</a></li>
            <li role="presentation" id="tab-info"><a href="#info">Datos Filiatorios</a></li>
          </ul>
          <div id="myTabContent" class="tab-content">
            <div role="tabpanel" class="tab-pane fade in active" id="detail" aria-labelledby="details-tab">
              {% if patient.social_work and patient.social_work.initial == 'APROSS' %}
                {% include "register/apross.html" %}
              {% else %}
                {% include "register/benefit.html" %}
              {% endif %}
            </div>
            <div role="tabpanel" class="tab-pane fade" id="total-detail" aria-labelledby="total-details-tab">
              {% include "register/total_details.html" with patient=patient %}
            </div>
            <div role="tabpanel" class="tab-pane fade" id="info" aria-labelledby="info-tab">
                <div class="col-md-12" style="margin-bottom: 20px; margin-top: 20px;">
                    <div class="col-md-3 no-padding">
                      <button type="button" class="btn btn-default" id="edit-patient-info">Editar info</button>
                      <button type="button" class="btn btn-success hide" id="save-patient-info" data-loading-text="Guardando &nbsp;<i class='fa fa-refresh fa-spin'></i>">Guardar cambios</button>
                      <button type="button" class="btn btn-default hide" id="cancel-patient-info">Cancelar</button>
                    </div>
                </div>
                <div class="col-md-12 content" style="margin-bottom: 20px;">
                {% include "person/patient_info.html" %}
                </div>
            </div>
            <div role="tabpanel" class="tab-pane fade" id="odontogram" aria-labelledby="ondontogram-tab">

                <table class="table table-bordered">
                  <tbody>
                    <tr>
                      <td colspan="2">
                        <div class="col-md-4">
                          <button type="button" class="btn btn-default" id="edit-odontogram">Editar odontograma</button>
                          <button type="button" class="btn btn-success hide" id="save-odontogram" data-loading-text="Guardando &nbsp;<i class='fa fa-refresh fa-spin'></i>">Guardar cambios</button>
                          <button type="button" class="btn btn-default hide" id="cancel-odontogram">Cancelar</button>
                        </div>
                        <div id="select-work-type" class="hide col-md-3">
                          <select class="selectpicker show-tick">
                            {% for val, text in work_types %}
                            <option value="{{val}}">{{text}}</option>
                            {% endfor %}
                            <option value="7" selected="selected">Limpiar</option>
                            <option value="" selected="selected">---------</option>
                          </select>
                        </div>
                        <div class="col-md-2">
                          <div class="btn-group" role="group" aria-label="...">
                            <button type="button" class="btn btn-default hide" id="button-red">
                              <span class="badge" style="background-color:rgba(255, 0, 0, 0.63);" data-color="red">&nbsp;&nbsp;</span>
                            </button>
                            <button type="button" class="btn btn-default hide active" id="button-blue">
                              <span class="badge" style="background-color: rgba(0, 0, 255, 0.63);" data-color="blue">&nbsp;&nbsp;</span>
                            </button>
                          </div>
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td width="200">
                        <table class="table table-bordered">
                          <tbody>
                            <tr><td class="text-center">Cantidad de Dientes</td></tr>
                            <tr><td id="text-teeth" class="text-center" style="font-size: 25px;">{{patient.odontogram.teeth_count|default:'---'}}</td></tr>
                          </tbody>
                        </table>
                      </td>
                      <td>
                        <div>
                            {% include "register/odontogram.html" %}
                        </div>
                      </td>
                    </tr>
                    <tr>
                      <td width="200">Periodo:</td>
                      <td>
                        <span class="field-odont" id="text-odontogram">{{odontogram_form.instance.period}}</span>
                        <span class="edit-odont hide">
                          <div class="date-group input-fields">
                              <div class='input-group date' id='date_odontogram'>
                                  <input class="form-control" id="id_date_odontogram" name="date_odontogram" type="text">
                                  <span class="input-group-addon">
                                      <span class="glyphicon glyphicon-calendar"></span>
                                  </span>
                              </div>
                          </div>
                        </span>
                      </td>
                    </tr>
                    <tr>
                      <td width="200">Observaciones:</td>
                      <td>
                        <span class="field-odont" id="text-observation">{{odontogram_form.instance.observations|default:'-'}}</span>
                        <span class="edit-odont hide">{{odontogram_form.observations}}</span>
                      </td>
                    </tr>
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
  </div>


</div>
{% endblock %}

{% block scripts %}
  <script type="text/javascript" src="{% static 'js/profile.js' %}"></script>
  <script type="text/javascript">
    url_profile = "{% url 'person:patient_profile' id=patient.id %}";
    URL_EDIT_BF = "{% url 'register:edit_benefit' patient_id=patient.id %}";
    URL_TO_PDF = "{% if last_benefit %}{% url 'register:benefit_to_pdf' patient_id=patient.id bf_id=last_benefit.id %}{% endif %}";
    URL_EDIT_ODONT = "{% url 'register:edit_odontogram' patient_id=patient.id %}";
    CSRF = "{{ csrf_token }}";
    URL_ACC_BF = "{% url 'register:acumulate_benefit' patient_id=patient.id %}";
    {% if odontogram_form.instance.month and odontogram_form.instance.year %}
    DATE_OD = "{{odontogram_form.instance.month}} - {{odontogram_form.instance.year}}";
    {% else %}
    DATE_OD = "";
    {% endif %}
  </script>
  <script type="text/javascript" src="{% static 'js/benefit.js'%}"></script>
  <script type="text/javascript" src="{% static 'js/patient_info.js'%}"></script>
  <script type="text/javascript" src="{% static 'js/odontogram.js'%}"></script>
  {% if rec_added == '1' %}
  <script type="text/javascript">
    $(function(){
      toastr.success('La ficha se ah creado correctamente.', 'NUEVA FICHA MENSUAL.');
    });
  </script>
  {% elif rec_added == '2' %}
  <script type="text/javascript">
    $(function(){
      toastr.success('La ficha ah sido editado correctamente.', 'FICHA MENSUAL EDITADA.');
    });
  </script>
  {% endif %}
{% endblock %}
